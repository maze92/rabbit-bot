<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>.rabbit Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/dashboard.css?v=20260209a">
</head>
<body>
  <div id="loginScreen" class="login-screen hidden">
    <div class="login-card">
      <h1 data-i18n="login_title">Login</h1>
      <p class="login-subtitle" data-i18n="login_subtitle">Autentica-te para aceder ao painel.</p>
      <button type="button" class="btn btn-discord" id="loginDiscordBtn" data-i18n="login_with_discord">Entrar com Discord</button>
      <div class="login-error" id="loginError"></div>
    </div>
  </div>

  <div id="guildSelectScreen" class="login-screen hidden">
    <div class="login-card">
      <h1 data-i18n="guild_select_title">Selecionar servidor</h1>
      <p class="login-subtitle" data-i18n="guild_select_subtitle">Escolhe o servidor que queres gerir.</p>
      <div id="guildSelectList" class="guild-select-list"></div>
      <div class="login-error" id="guildSelectError"></div>
    </div>
  </div>

  <div class="app" id="appRoot">
    <!-- Top bar -->
    <header class="topbar">
      <div class="topbar-left">
        <div class="logo">.rabbit</div>
        <div class="divider"></div>
        <div class="top-info">
          <div data-i18n="app_subtitle">Painel de gest√£o e modera√ß√£o</div>
        </div>
      </div>
      <div class="topbar-right">
        <select id="guildPicker" class="select">
          <option value="" data-i18n="select_guild">Selecione um servidor</option>
        </select>

        <button type="button" class="badge badge-logout" id="logoutBtn" data-i18n="logout" aria-label="Sair">Sair</button>

        <span class="badge hidden" id="badgeProfile"></span>
        <span class="badge hidden" id="badgeAccess"></span>

        <span class="badge" id="badgeBot">Bot online</span>
      </div>
    </header>

    <!-- Tabs -->
    <div class="tabs" id="tabs">
      <button class="tab active" data-tab="overview" data-i18n="tab_overview">Vis√£o geral</button>
      <button class="tab" data-tab="logs" data-i18n="tab_logs">Modera√ß√£o</button>
      <button class="tab" data-tab="gamenews" data-i18n="tab_gamenews">Funcionalidades</button>
      <button class="tab" data-tab="user" data-i18n="tab_user">Utilizadores</button>
      <button class="tab" data-tab="config" data-i18n="tab_config">Configura√ß√£o</button>
    </div>

    <!-- Aviso quando n√£o h√° servidor selecionado -->
    <div id="tabWarning" class="tab-warning hidden" data-i18n="warn_select_guild">
      Selecione um servidor para aceder √†s restantes sec√ß√µes.
    </div>
    <!-- Banner global (estado / avisos contextuais) -->
    <div id="globalBanner" class="global-banner hidden" role="region" aria-label="Avisos">
      <div class="global-banner__content">
        <div class="global-banner__title" id="globalBannerTitle"></div>
        <div class="global-banner__message" id="globalBannerMessage"></div>
      </div>
      <div class="global-banner__actions" id="globalBannerActions"></div>
      <button type="button" class="icon-btn global-banner__close" id="globalBannerClose" aria-label="Fechar">√ó</button>
    </div>


    <!-- Sections -->
    <main class="sections">
      <!-- Overview -->
      <section class="section active" id="tab-overview">
        <div class="card">
          <h2 data-i18n="overview_title">Vis√£o geral</h2>
          <p class="hint" data-i18n="overview_hint">
            Resumo de alto n√≠vel sobre o estado do bot, servidores ligados e atividade recente.
          </p>
          <div class="grid-3">
            <div class="kpi">
              <div class="kpi-label" data-i18n="kpi_guilds">Servidores ligados</div>
              <div class="kpi-value" id="kpiGuilds">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="kpi-label" data-i18n="kpi_users">Utilizadores monitorizados</div>
              <div class="kpi-value" id="kpiUsers">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="kpi-label" data-i18n="kpi_actions_24h">A√ß√µes de modera√ß√£o (√∫ltimas 24h)</div>
              <div class="kpi-value" id="kpiActions24h">‚Äî</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Logs / Modera√ß√£o -->
      <section class="section" id="tab-logs">
        <div class="card">
          <h2 data-i18n="logs_title">Hub de modera√ß√£o</h2>
          <p class="hint" data-i18n="logs_hint">
            Consulta centralizada de avisos, mutes, bans e restantes a√ß√µes de modera√ß√£o.
          </p>
          
          
          
          <div class="user-layout moderation-panels" id="moderationOverviewLayout">
            <div class="user-detail mini-panel" id="modServerInsightsPanel">
              <div class="mini-panel-header">
                <div>
                  <h3 data-i18n="logs_server_insights_title">An√°lises do Servidor</h3>
                  <p class="hint" data-i18n="logs_server_insights_hint">
                    Resumo r√°pido das a√ß√µes de modera√ß√£o.
                  </p>
                </div>
              </div>
              <div class="chips" id="modServerInsightsRange">
                  <button class="chip chip-active" data-range="7d" data-i18n="range_7d">7d</button>
                  <button class="chip" data-range="14d" data-i18n="range_14d">14d</button>
                  <button class="chip" data-range="30d" data-i18n="range_30d">30d</button>
              </div>
              <div id="modServerInsightsContent">
                <div class="empty" data-i18n="logs_server_insights_empty">
                  Ainda n√£o existem dados de modera√ß√£o no per√≠odo selecionado.
                </div>
              </div>
            </div>

            <div class="user-detail mini-panel" id="modTicketsPanel">
              <div class="mini-panel-header">
                <div>
                  <h3 data-i18n="logs_tickets_panel_title">An√°lises de Tickets</h3>
                  <p class="hint" data-i18n="logs_tickets_panel_hint">
                    Vista dos tickets recebidos por per√≠odo.
                  </p>
                </div>
              </div>
              <div class="chips" id="modTicketsRange">
                  <button class="chip chip-active" data-range="7d" data-i18n="range_7d">7d</button>
                  <button class="chip" data-range="14d" data-i18n="range_14d">14d</button>
                  <button class="chip" data-range="30d" data-i18n="range_30d">30d</button>
              </div>
              <ul class="simple-list" id="modTicketsList">
                <li class="empty" data-i18n="logs_tickets_panel_empty">
                  N√£o existem tickets no per√≠odo selecionado.
                </li>
              </ul>
              <div class="pagination pagination-small">
                <button class="btn btn-ghost" id="modTicketsPrevPage">&laquo;</button>
                <button class="btn btn-ghost" id="modTicketsNextPage">&raquo;</button>
              </div>
            </div>

            <div class="user-detail mini-panel" id="modTopOnlinePanel">
              <h3 data-i18n="logs_top_online_title">Registo de Utilizadores Online</h3>
              <p class="hint" data-i18n="logs_top_online_hint">
                Vista r√°pida dos utilizadores mais presentes no servidor.
              </p>
              <div class="chips" id="modTopOnlineRange">
                <button class="chip chip-active" data-range="7d" data-i18n="range_7d">7d</button>
                <button class="chip" data-range="14d" data-i18n="range_14d">14d</button>
                <button class="chip" data-range="30d" data-i18n="range_30d">30d</button>
              </div>
              <ul class="simple-list" id="modTopOnlineList">
                <li class="empty" data-i18n="logs_top_online_soon">
                  Em breve: painel alimentado por dados reais de presen√ßa.
                </li>
              </ul>
            </div>
          </div>
          <div class="user-detail mini-panel" id="modServerRecordsPanel">
          <h3 data-i18n="logs_server_records_title">Registos do Servidor</h3>
          <p class="hint" data-i18n="logs_server_records_hint">
            Resumo r√°pido das a√ß√µes de modera√ß√£o nas √∫ltimas 24 horas.
          </p>
          <div class="row gap">
            <input
              id="logSearch"
              class="input"
              data-i18n-placeholder="logs_search_placeholder"
              placeholder="Procurar por utilizador, moderador ou detalhe do log"
            >
            <select id="logType" class="select sm">
              <option value="" data-i18n="logs_filter_all">Todos os tipos</option>
              <option value="warn" data-i18n="logs_filter_warn">Warn</option>
              <option value="mute" data-i18n="logs_filter_mute">Mute</option>
              <option value="unmute" data-i18n="logs_filter_unmute">Unmute</option>
              <option value="kick" data-i18n="logs_filter_kick">Kick</option>
              <option value="ban" data-i18n="logs_filter_ban">Ban</option>
              <option value="tickets" data-i18n="logs_filter_tickets">Tickets</option>
            </select>
            <select id="logLimit" class="select xs">
              <option value="10">10</option>
              <option value="25">25</option>
              <option value="50">50</option>
            </select>
            <button class="btn" id="btnReloadLogs" data-i18n="logs_reload">Recarregar</button>
          </div>
          <div id="logsList" class="list">
            <div class="empty" data-i18n="logs_empty">
              N√£o existem registos para o filtro atual.
            </div>
          <div class="row" style="margin-top: 8px;">
            <button class="btn" id="btnLogsLoadMore" data-i18n="logs_load_more">Carregar mais</button>
          </div>
          </div>
          </div>

        </div>
      </section>

      <!-- Tickets -->
            <!-- Extras -->
      <section class="section" id="tab-gamenews">
        <div class="card">
          <h2 data-i18n="extras_title">Funcionalidades</h2>
          <p class="hint" data-i18n="extras_hint">
            Ferramentas adicionais do bot: feeds de not√≠cias e voz tempor√°ria.
          </p>

          <div class="subtabs">
            <button class="subtab active" data-subtab="feeds" data-i18n="extras_feeds_tab">Feeds</button>
            <button class="subtab" data-subtab="tempvoice" data-i18n="extras_tempvoice_tab">Voz tempor√°ria</button>
            <button class="subtab" data-subtab="tickets" data-i18n="extras_tickets_tab">Tickets</button>
            <button class="subtab" data-subtab="trust" data-i18n="extras_trust_tab">Modera√ß√£o</button>
            <button class="subtab" data-subtab="freetokeep" data-i18n="extras_freetokeep_tab">FreeToKeep</button>
          </div>

          <div class="subtab-panels">
            <div class="subtab-panel active" id="extras-feeds-panel">
<div class="card">
    <h2 data-i18n="gamenews_title">GameNews</h2>
    <p class="hint" data-i18n="gamenews_hint">
      Estado dos feeds de not√≠cias e √∫ltimas publica√ß√µes.
    </p>

    <div class="user-layout gamenews-layout">
      <!-- Lado esquerdo: lista + a√ß√µes gerais -->
      <div>
        <div class="row gap" style="margin-bottom: 8px;">
          <button id="btnAddGameNewsFeed" class="btn xs" type="button" data-i18n="gamenews_add_feed">
            Adicionar
          </button>
        </div>

        <div class="list" id="gamenewsFeedsList">
          <div class="empty" data-i18n="gamenews_editor_empty">
            Nenhum feed de GameNews configurado neste momento.
          </div>
        </div>
      </div>

      <!-- Lado direito: painel de detalhe (como userDetailPanel) -->
      <div class="user-detail gamenews-detail mini-panel" id="gamenewsFeedDetailPanel">
        <div class="empty" data-i18n="gamenews_detail_empty">
          Selecione um feed para ver os detalhes e editar a configura√ß√£o.
        </div>
      </div>
    </div>
  </div>
            </div>

                          <div class="subtab-panel" id="extras-tempvoice-panel">
                <div class="card subcard">
                  <h2 data-i18n="tempvoice_title">Voz tempor√°ria</h2>
                  <p class="history-hint" data-i18n="tempvoice_hint">
                    Cria canais de voz tempor√°rios por utilizador, que s√£o apagados automaticamente quando ficam vazios.
                  </p>

                  <div class="row gap" style="margin-bottom: 8px;">
                    <select id="tempVoiceAddBaseSelect" class="select" style="flex:1; min-width: 220px;"></select>
                    <button id="btnTempVoiceAddBase" class="btn xs" type="button" data-i18n="tempvoice_add_base_btn">
                      Adicionar
                    </button>
                  </div>

                  <div class="user-layout">
                    <div>
                      <div class="list" id="tempVoiceBaseList">
                        <div class="empty" data-i18n="tempvoice_base_list_empty">
                          Ainda n√£o existem canais base configurados.
                        </div>
                      </div>
                    </div>

                    <div class="user-detail mini-panel" id="tempVoiceDetailPanel">
                      <div class="empty" id="tempVoiceDetailEmpty" data-i18n="tempvoice_detail_empty">
                        Selecione um canal base para editar as configura√ß√µes.
                      </div>

                      <div id="tempVoiceDetailContent" style="display:none;">
                        <h3 data-i18n="tempvoice_detail_title">Configura√ß√µes de Canal de Voz Tempor√°rio</h3>
                        <p class="history-hint" data-i18n="tempvoice_detail_hint">
                          Define o comportamento global das salas tempor√°rias criadas a partir dos canais base.
                        </p>

                        <h4 id="tempVoiceCurrentBaseLabel" class="subtitle" data-i18n="tempvoice_current_base">
                          Canal base: (nenhum selecionado)
                        </h4>

                        <div class="field">
                          <label for="tempVoiceEnabled" data-i18n="tempvoice_enabled_label">Ativar voz tempor√°ria</label>
                          <select id="tempVoiceEnabled" class="select">
                            <option value="false" data-i18n="tempvoice_disabled">Desativado</option>
                            <option value="true" data-i18n="tempvoice_enabled">Ativado</option>
                          </select>
                        </div>
                        <div class="field">
                          <label for="tempVoiceCategoryId" data-i18n="tempvoice_category_label">Categoria para criar salas tempor√°rias</label>
                          <select id="tempVoiceCategoryId" class="input"></select>
                        </div>

                        <div class="field">
                          <label for="tempVoiceDeleteDelay" data-i18n="tempvoice_delete_delay_label">Tempo para apagar sala vazia (segundos)</label>
                          <input id="tempVoiceDeleteDelay" class="input" type="number" min="2" max="600" step="1" />
                        </div>
                        
                        <div class="field">
                          <label for="tempVoiceMaxUsers" data-i18n="tempvoice_max_users_label">Limite m√°ximo de utilizadores por sala</label>
                          <input id="tempVoiceMaxUsers" class="input" type="number" min="1" max="99" step="1" placeholder="(opcional)" />
                        </div>

                        <div class="field field-spaced-top">
                          <h4 style="margin:0 0 8px 0;" data-i18n="tempvoice_actions_title">A√ß√µes</h4>
                          <div class="actions tempvoice-actions-top">
                            <button id="btnSaveTempVoice" class="btn xs" type="button" data-i18n="tempvoice_save_btn">
                              Guardar
                            </button>
                            <button id="btnDeleteTempVoiceBase" class="btn xs danger" type="button" data-i18n="tempvoice_delete_btn">
                              Remover
                            </button>
                          </div>
                          <div class="hint" id="tvDirtyHint" style="display:none; margin-top:6px;"></div>
                        </div>

                        <div class="field field-spaced-top">
                          <div class="tempvoice-active-header">
                            <h4 data-i18n="tempvoice_active_title">Salas tempor√°rias ativas</h4>
                          </div>
                          <div class="list" id="tempVoiceActiveList">
                            <div class="empty" data-i18n="tempvoice_active_empty">
                              N√£o existem salas tempor√°rias neste momento.
                            </div>
                          </div>
                        </div>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>
	          
	              <div class="subtab-panel" id="extras-tickets-panel">
                <div class="card subcard">
                  <h2 data-i18n="tickets_extras_title">Tickets</h2>
                  <p class="hint" data-i18n="tickets_extras_hint">
                    Configura√ß√£o do canal de suporte e comportamento b√°sico do sistema de tickets.
                  </p>

                  <details class="card" style="margin-top:12px;" open>
                    <summary class="details-summary" data-i18n="tickets_config_summary">Configura√ß√£o</summary>
                    <div class="row gap" style="margin-top:10px;">
                      <div class="col">
                        <label for="configTicketChannel" data-i18n="config_ticket_channel">Canal de suporte (tickets)</label>
                        <select id="configTicketChannel" class="select"></select>
                        <p class="hint" data-i18n="config_ticket_channel_hint">
                          Canal onde ser√° publicada a mensagem de suporte com o emoji para abrir tickets.
                        </p>
                      </div>
                    </div>
                  </details>

                  <details class="card" style="margin-top:12px;">
                    <summary class="details-summary" data-i18n="tickets_how_summary">Como funciona</summary>
                    <div style="margin-top:10px;">
                      <p class="hint" data-i18n="tickets_extras_info_body">
                        Quando configuras um canal de suporte, o sistema permite abrir threads de ticket a partir de uma mensagem fixa com o emoji üé´. Cada ticket fica registado e pode ser consultado na tab de modera√ß√£o.
                      </p>
                      <p class="hint" data-i18n="tickets_extras_logs_hint">
                        Esta sec√ß√£o utiliza o sistema de logs de tickets existente. Os registos aparecem em "An√°lises de Tickets" e em "Registos do Servidor" na tab Hub de modera√ß√£o.
                      </p>
                    </div>
                  </details>

                  <div class="card" style="margin-top:12px;">
                    <div class="users-layout">
                      <div class="users-left">
                        <div class="toolbar" style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
                          <div class="title" data-i18n="tickets_manage_title">Tickets ativos</div>
                          <div style="display:flex; gap:6px; align-items:center; flex-wrap:wrap; justify-content:flex-end;">
                            <input id="ticketsSearch" class="input md" type="text" placeholder="Pesquisar..." data-i18n-placeholder="tickets_search_placeholder" />
                            <select id="ticketsStatusFilter" class="select xs">
                              <option value="open" data-i18n="tickets_filter_open">Abertos</option>
                              <option value="closed" data-i18n="tickets_filter_closed">Fechados</option>
                              <option value="all" data-i18n="tickets_filter_all">Todos</option>
                            </select>
                            <button id="btnReloadTickets" class="btn xs" type="button" data-i18n="reload">Recarregar</button>
                          </div>
                        </div>
                        <div class="list" id="ticketsList">
                          <div class="empty" data-i18n="tickets_select_guild">Selecione um servidor para ver tickets.</div>
                        </div>
                        <div style="display:flex; justify-content:flex-end; margin-top:8px;">
                          <button id="btnTicketsLoadMore" class="btn xs" type="button" style="display:none;" data-i18n="tickets_load_more">Carregar mais</button>
                        </div>
                      </div>

                      <div class="users-right">
                        <div id="ticketDetailPanel" class="mini-panel">
                          <div class="empty" data-i18n="tickets_detail_empty">Selecione um ticket para ver detalhes.</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="subtab-panel" id="extras-trust-panel">
                <div class="card subcard">
                  <h2 data-i18n="extras_trust_title">Sistema de Trust</h2>
                  <p class="hint" data-i18n="extras_trust_hint">
                    Vis√£o geral do sistema de confian√ßa usado para avaliar o risco dos utilizadores com base no seu hist√≥rico.
                  </p>

                  <div class="trust-layout">
                    <div class="trust-form-block">
                      <h4 data-i18n="extras_trust_levels_title">N√≠veis de confian√ßa</h4>
                      <p data-i18n="extras_trust_levels_body">
                        Os utilizadores recebem automaticamente n√≠veis Alto, M√©dio ou Baixo com base nas infra√ß√µes registadas.
                      </p>

                      <div class="trust-form-row">
                        <label for="trustPresetSelect" data-i18n="trust_preset_label">Preset</label>
                        <div class="row gap">
                          <select id="trustPresetSelect" class="select" disabled>
                            <option value="balanced" data-i18n="trust_preset_balanced">Equilibrado</option>
                            <option value="strict" data-i18n="trust_preset_strict">Rigoroso</option>
                            <option value="relaxed" data-i18n="trust_preset_relaxed">Flex√≠vel</option>
                            <option value="custom" data-i18n="trust_preset_custom">Personalizado</option>
                          </select>
                          <button id="btnApplyTrustPreset" class="btn xs" type="button" disabled data-i18n="trust_preset_apply">Aplicar</button>
                        </div>
                        <div class="hint" data-i18n="trust_preset_hint">Escolha um preset e aplique. Depois pode ajustar manualmente e guardar.</div>
                      </div>

                      <div class="trust-form-row">
                        <label for="trustBaseInput" data-i18n="config_trust_base">Base level</label>
                        <input id="trustBaseInput" type="number" class="input" value="50" disabled />
                      </div>

                      <div class="trust-form-row">
                        <label data-i18n="config_trust_minmax">Minimum / Maximum</label>
                        <div class="row gap">
                          <input id="trustMinInput" type="number" class="input xs" value="0" disabled />
                          <input id="trustMaxInput" type="number" class="input xs" value="100" disabled />
                        </div>
                      </div>

                      <div class="trust-form-row">
                        <label data-i18n="config_trust_penalties">Penalties</label>
                        <div class="row gap">
                          <input id="trustWarnPenaltyInput" type="number" class="input xs" placeholder="WARN" value="10" disabled />
                          <input id="trustMutePenaltyInput" type="number" class="input xs" placeholder="MUTE" value="25" disabled />
                        </div>
                      </div>

                      <div class="trust-form-row">
                        <label data-i18n="config_trust_regen">Regeneration</label>
                        <div class="row gap">
                          <input id="trustRegenPerDayInput" type="number" class="input xs" placeholder="por dia" value="5" disabled />
                          <input id="trustRegenMaxDaysInput" type="number" class="input xs" placeholder="m√°x. dias" value="14" disabled />
                        </div>
                      </div>

                      <div class="trust-form-row">
                        <label data-i18n="config_trust_risk">Thresholds</label>
                        <div class="row gap">
                          <input id="trustLowThresholdInput" type="number" class="input xs" placeholder="baixo" value="30" disabled />
                          <input id="trustHighThresholdInput" type="number" class="input xs" placeholder="alto" value="70" disabled />
                        </div>
                      </div>

                      <div class="row gap" style="margin-top:10px;">
                        <button id="btnSaveTrustConfig" class="btn xs" type="button" disabled data-i18n="trust_save">Guardar Trust</button>
                        <span class="hint" id="trustSaveStatus"></span>
                      </div>
                    </div>
                    <div class="trust-preview-block">
                      <h4 data-i18n="extras_trust_preview_title">Resumo</h4>

                      <div class="trust-config-grid">
                        <div class="trust-config-item">
                          <div class="label" data-i18n="trust_preview_base">Base</div>
                          <div class="value" id="trustBaseValue">‚Äî</div>
                        </div>
                        <div class="trust-config-item">
                          <div class="label" data-i18n="trust_preview_minmax">M√≠n / M√°x</div>
                          <div class="value" id="trustMinMaxValue">‚Äî</div>
                        </div>
                        <div class="trust-config-item">
                          <div class="label" data-i18n="trust_preview_penalties">Penaliza√ß√µes</div>
                          <div class="value" id="trustPenaltiesValue">‚Äî</div>
                        </div>
                        <div class="trust-config-item">
                          <div class="label" data-i18n="trust_preview_regen">Regenera√ß√£o</div>
                          <div class="value" id="trustRegenValue">‚Äî</div>
                        </div>
                        <div class="trust-config-item">
                          <div class="label" data-i18n="trust_preview_risk">Thresholds</div>
                          <div class="value" id="trustRiskValue">‚Äî</div>
                        </div>
                      </div>

                      <h4 style="margin-top:12px;" data-i18n="extras_trust_info_title">Como funciona</h4>
                      <div class="trust-info" data-i18n="extras_trust_info_body"></div>
                    </div>

                  </div>
                </div>
              </div>

              <div class="subtab-panel" id="extras-freetokeep-panel">
                <div class="panel">
                  <div class="panel-header">
                    <div>
                      <div class="panel-title" data-i18n="freetokeep_title">Free-to-keep</div>
                      <div class="muted" data-i18n="freetokeep_subtitle">Publica automaticamente jogos gratuitos (para ficar) da Epic, Steam e Ubisoft.</div>
                    </div>
                    <div class="panel-actions">
                      <button class="btn xs" id="freeToKeepRefresh" type="button" data-i18n="common_refresh">Recarregar</button>
                      <button class="btn xs" id="freeToKeepTest" type="button" data-i18n="freetokeep_test">Testar agora</button>
                      <button class="btn xs primary" id="freeToKeepSave" type="button" data-i18n="common_save">Guardar</button>
                    </div>
                  </div>

                  <div class="freetokeep-layout">
                    <div class="freetokeep-left">
                      <div class="card">
                        <div class="card-title" data-i18n="freetokeep_config">Configura√ß√£o</div>
                        <div class="form">
                          <div class="row gap" style="align-items:center;">
                            <label class="checkbox-row" style="margin:0;">
                              <input type="checkbox" id="freeToKeepEnabled" />
                              <span data-i18n="freetokeep_enabled">Ativo</span>
                            </label>
                            <div class="muted" data-i18n="freetokeep_enabled_hint">Quando ativo, o bot verifica ofertas e publica no canal selecionado.</div>
                          </div>

                          <label data-i18n="freetokeep_channel">Canal de publica√ß√£o</label>
                          <select id="freeToKeepChannel" class="select"></select>

                          <div class="row gap freetokeep-inline" style="flex-wrap:nowrap;">
                            <div>
                              <label data-i18n="freetokeep_poll">Intervalo (min)</label>
                              <input id="freeToKeepPollMinutes" class="input xs" type="number" min="1" max="60" value="2" />
                            </div>
                            <div>
                              <label data-i18n="freetokeep_max">M√°ximo por ciclo</label>
                              <input id="freeToKeepMaxPerCycle" class="input xs" type="number" min="1" max="10" value="3" />
                            </div>
                          </div>

                          <div class="hr"></div>

                          <div class="grid-2" style="gap:12px;">
                            <div>
                              <label data-i18n="freetokeep_platforms">Plataformas</label>
                              <div class="stack">
                                <label class="checkbox-row"><input type="checkbox" id="freeToKeepEpic" checked /> <span>Epic Games Store</span></label>
                                <label class="checkbox-row"><input type="checkbox" id="freeToKeepSteam" checked /> <span>Steam</span></label>
                                <label class="checkbox-row"><input type="checkbox" id="freeToKeepUbisoft" checked /> <span>Ubisoft</span></label>
                              </div>
                            </div>

                            <div>
                              <label data-i18n="freetokeep_offer_types">Tipos de ofertas</label>
                              <div class="stack">
                                <label class="checkbox-row"><input type="checkbox" id="freeToKeepTypeKeep" checked /> <span data-i18n="freetokeep_type_keep">Free-to-keep</span></label>
                                <label class="checkbox-row"><input type="checkbox" id="freeToKeepTypeWeekend" /> <span data-i18n="freetokeep_type_weekend">Free weekend</span></label>
                              </div>
                            </div>
                          </div>

                          <div class="muted" id="freeToKeepStatus"></div>
                        </div>
                      </div>

                      <div class="card">
                        <div class="card-title" data-i18n="freetokeep_recent">Enviados recentemente</div>
                        <div class="muted" data-i18n="freetokeep_recent_hint">Clica num item para pr√©-visualizar o embed.</div>
                        <div id="freeToKeepRecent" class="list"></div>
                      </div>
                    </div>

                    <div class="freetokeep-right">
                      <div class="card">
                        <div class="card-title" data-i18n="freetokeep_preview">Pr√©-visualiza√ß√£o</div>
                        <div class="muted" id="freeToKeepPreviewHint" data-i18n="freetokeep_preview_hint">Usa ‚ÄúTestar agora‚Äù para ver como o embed ser√° enviado.</div>
                        <div id="freeToKeepPreview" class="embed-preview-wrap"></div>
                        <div class="row gap" style="justify-content:flex-end; margin-top:12px;">
                          <button class="btn" id="freeToKeepPreviewSend" type="button" data-i18n="freetokeep_send_test">Enviar teste</button>
                        </div>
                      </div>

                      <div class="card">
                        <div class="card-title" data-i18n="freetokeep_health">Estado</div>
                        <div class="stack">
                          <div class="row" style="justify-content:space-between;">
                            <div class="muted" data-i18n="freetokeep_last_run">√öltima verifica√ß√£o</div>
                            <div id="freeToKeepLastRun" class="mono muted">‚Äî</div>
                          </div>
                          <div class="row" style="justify-content:space-between;">
                            <div class="muted" data-i18n="freetokeep_last_error">√öltimo erro</div>
                            <div id="freeToKeepLastError" class="mono muted">‚Äî</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

      <section class="section" id="tab-user">
        <div class="card">
          <h2 data-i18n="users_title">Utilizadores</h2>
          <p class="hint" data-i18n="users_hint">Consulta r√°pida de utilizadores e hist√≥rico de modera√ß√£o por utilizador.</p>
          <p class="hint users-members" id="usersMemberCount"></p>

          <div class="user-layout users-layout">
            <div>
              <div class="row gap" style="margin-bottom: 8px;">
                <input id="usersSearch" class="input" data-i18n-placeholder="users_search_placeholder" placeholder="Procurar utilizador ou ID">
                <select id="usersLimit" class="select xs">
                  <option value="25">25</option>
                  <option value="50" selected>50</option>
                  <option value="100">100</option>
                </select>
                <button class="btn" id="btnReloadUsers" data-i18n="users_reload">Recarregar</button>
                <button class="btn" id="btnSyncUsers" data-i18n="users_sync">Sincronizar</button>
              </div>

              <div class="list" id="usersList">
                <div class="empty" data-i18n="users_empty">Selecione um servidor para ver utilizadores.</div>
              </div>

              <div class="row" style="margin-top: 8px;">
                <button class="btn" id="btnUsersLoadMore" data-i18n="users_load_more">Carregar mais</button>
              </div>
            </div>

            <div class="user-detail mini-panel" id="userDetailPanel">
              <div class="empty" data-i18n="users_detail_empty">Selecione um utilizador para ver o hist√≥rico de modera√ß√£o e tickets.</div>
            </div>
          </div>
        </div>
      </section>

      <section class="section" id="tab-config">
        <div class="card">
          <h2 data-i18n="config_title">Configura√ß√£o do servidor</h2>
          <p class="hint" data-i18n="config_hint">Defina canais, cargos de staff e prefer√™ncias de registo para este servidor.</p>

          <div class="config-nav" aria-label="Config navigation">
            <a class="config-pill" href="#config-section-guild" data-i18n="config_nav_guild">Servidor</a>
            <a class="config-pill" href="#config-section-logs" data-i18n="config_nav_logs">Logs</a>
            <a class="config-pill" href="#config-section-access" data-i18n="config_nav_access">Acesso</a>
            <a class="config-pill" href="#config-section-maintenance" data-i18n="config_nav_maintenance">Manuten√ß√£o</a>
            <a class="config-pill" href="#config-section-advanced" data-i18n="config_nav_advanced">Avan√ßado</a>
          </div>

          <div class="config-form">
            <div class="card subcard" id="config-section-guild">
              <h3 data-i18n="config_guild_settings_title">Prefer√™ncias do servidor</h3>
              <p class="hint" data-i18n="config_guild_settings_hint">Defina o idioma principal e a timezone usados pela dashboard para este servidor.</p>

              <div class="row gap">
                <div class="field">
                  <label for="configServerLanguage" data-i18n="config_server_language_label">Idioma principal do servidor</label>
                  <select id="configServerLanguage" class="select">
                    <option value="auto" data-i18n="config_server_language_auto">Autom√°tico (seguir idioma do cliente)</option>
                    <option value="pt" data-i18n="config_server_language_pt">Portugu√™s</option>
                    <option value="en" data-i18n="config_server_language_en">English</option>
                  </select>
                </div>

                <div class="field">
                  <label for="configServerTimezone" data-i18n="config_server_timezone_label">Timezone do servidor</label>
                  <input id="configServerTimezone" class="input" type="text" placeholder="Europe/Lisbon" />
                </div>
              </div>
              <p class="hint" data-i18n="config_server_timezone_hint">Use um identificador IANA (por exemplo, Europe/Lisbon). Se ficar vazio, √© usado o fuso hor√°rio padr√£o do servidor.</p>
            </div>

            <div class="card subcard" id="config-section-logs">
              <h3 data-i18n="config_logs_section_title">Registos e canais de logs</h3>
              <p class="hint" data-i18n="config_logs_section_hint">Defina os canais onde ser√£o enviados os registos principais e os logs da pr√≥pria dashboard.</p>

              <div class="row gap">
                <div class="col">
                  <label for="configLogChannel" data-i18n="config_log_channel">Canal de logs principal</label>
                  <select id="configLogChannel" class="select"></select>
                </div>
                <div class="col">
                  <label for="configDashboardLogChannel" data-i18n="config_dashboard_log_channel">Canal de logs da dashboard</label>
                  <select id="configDashboardLogChannel" class="select"></select>
                </div>
              </div>
            </div>

            <div class="card subcard" id="config-section-access">
              <h3 data-i18n="config_access_section_title">Acesso e cargos de staff</h3>
              <p class="hint" data-i18n="config_access_section_hint">O login na dashboard √© feito apenas via Discord OAuth e √© restrito a Owners e Administradores do servidor. Aqui definis apenas os cargos de staff usados pelo bot.</p>

              <div class="row gap staff-roles-row">
                <div class="col">
                  <label for="configStaffRoles" data-i18n="config_staff_roles">Cargos de staff</label>
                  <select id="configStaffRoles" class="select role-picker-hidden" multiple></select>
                  <div class="role-picker" data-target="configStaffRoles">
                    <div class="role-chips" id="configStaffRolesChips"></div>
                    <div class="role-add-row">
                      <select id="configStaffRolesAdd" class="select"></select>
                      <button type="button" class="btn xs" id="configStaffRolesAddBtn" data-i18n="config_rolepicker_add">Adicionar</button>
                    </div>
                  </div>
                  <p class="hint" data-i18n="config_staff_roles_hint">Se vazio, s√£o usadas as roles de staff globais definidas no ficheiro de configura√ß√£o.</p>
                </div>
              </div>
            </div>

            <div class="card subcard" id="config-section-maintenance">
              <h3 data-i18n="config_maintenance_title">Modo de manuten√ß√£o</h3>
              <p class="hint" data-i18n="config_maintenance_hint">Quando ativo, o bot limita comandos a Administradores/Owner e cargos de staff. Restantes utilizadores recebem uma mensagem curta.</p>

              <div class="row gap">
                <div class="col">
                  <label for="configMaintenanceEnabled" data-i18n="config_maintenance_enabled_label">Ativar manuten√ß√£o</label>
                  <select id="configMaintenanceEnabled" class="select">
                    <option value="false" data-i18n="common_no">N√£o</option>
                    <option value="true" data-i18n="common_yes">Sim</option>
                  </select>
                </div>
                <div class="col">
                  <label for="configMaintenanceMessage" data-i18n="config_maintenance_message_label">Mensagem</label>
                  <input id="configMaintenanceMessage" class="input" type="text" maxlength="180" data-i18n-placeholder="config_maintenance_message_placeholder" placeholder="O bot est√° em manuten√ß√£o. Tenta mais tarde." />
                </div>
              </div>
            </div>

            <div class="card subcard" id="config-section-advanced">
              <details class="config-advanced">
                <summary data-i18n="config_json_section_title">Avan√ßado: importar/exportar configura√ß√£o</summary>
                <p class="hint" data-i18n="config_json_section_hint">Exporta a configura√ß√£o atual deste servidor para JSON ou aplica rapidamente uma configura√ß√£o j√° preparada.</p>

                <div class="row gap">
                  <div class="col">
                    <label data-i18n="config_json_export_label">Exportar configura√ß√£o atual</label>
                    <textarea id="configJsonExport" class="input" rows="6" readonly></textarea>
                    <button type="button" class="btn small" id="configJsonExportBtn" data-i18n="config_json_export_btn">Gerar JSON</button>
                  </div>
                  <div class="col">
                    <label for="configJsonImport" data-i18n="config_json_import_label">Importar configura√ß√£o (JSON)</label>
                    <textarea id="configJsonImport" class="input" rows="6"></textarea>
                    <button type="button" class="btn small primary" id="configJsonImportBtn" data-i18n="config_json_import_btn">Aplicar JSON</button>
                  </div>
                </div>
              </details>
            </div>
          </div>

          <div class="config-actions-footer">
            <button type="button" class="btn small" id="btnReloadGuildConfig" data-i18n="config_reload">Recarregar</button>
            <button type="button" class="btn small primary" id="btnSaveGuildConfig" data-i18n="config_save">Guardar configura√ß√£o</button>
          </div>
          <div id="configStatus" class="hint" style="margin-top:8px;"></div>
        </div>
      </section>

</main>
  </div>


  <!-- Drawer global para edi√ß√µes detalhadas (utilizadores, tickets, GameNews, etc.) -->
  <div id="drawerOverlay" class="drawer-overlay" style="display:none;">
    <div id="drawerPanel" class="drawer-panel">
      <button type="button" id="drawerCloseBtn" class="drawer-close">&times;</button>
      <div id="drawerContent" class="drawer-content"></div>
    </div>
  </div>

  <script src="/js/i18n.js?v=20260209a" defer></script>
  <script src="/js/dashboard.js?v=20260209a" defer></script>
  <script src="/js/dashboard.users.js?v=20260209a" defer></script>
  <script src="/js/dashboard.moderation.js?v=20260209a" defer></script>
  <script src="/js/dashboard.gamenews.js?v=20260209a" defer></script>
  <script src="/js/dashboard.tickets.js?v=20260209a" defer></script>
  <script src="/js/dashboard.freetokeep.js?v=20260209a" defer></script>

<!-- Moderation Action Modal -->
<div id="modActionModal" class="modal hidden">
  <div class="modal-backdrop"></div>
  <div class="modal-card">
    <h3 id="modActionTitle">Moderation</h3>
    <div class="modal-body">
      <label for="modActionReason">Reason</label>
<input id="modActionReason" class="input" type="text" placeholder="" />

      <div id="modActionDurationWrap" class="hidden">
        <label for="modActionDuration">Duration</label>
<input id="modActionDuration" class="input" type="text" placeholder="10m, 1h, 1d" />
      </div>
    </div>
    <div class="modal-actions">
      <button id="modActionCancel" class="btn">Cancel</button>
      <button id="modActionConfirm" class="btn primary">Confirm</button>
    </div>
  </div>
</div>

</body>
</html>